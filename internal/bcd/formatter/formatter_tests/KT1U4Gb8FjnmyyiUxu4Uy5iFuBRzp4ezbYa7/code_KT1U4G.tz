parameter (or (unit %auto_call) (ticket %run int));
storage (pair (option %x (ticket int)) (option %y (ticket string)));
code { UNPAIR ;
       IF_LEFT
         { DROP ;
           PUSH nat 43 ;
           PUSH int 1 ;
           TICKET_DEPRECATED ;
           NIL operation ;
           SELF %run ;
           PUSH mutez 0 ;
           DIG 3 ;
           TRANSFER_TOKENS ;
           CONS }
         { READ_TICKET ;
           PUSH nat 42 ;
           PUSH string "abc" ;
           TICKET_DEPRECATED ;
           DIG 3 ;
           SWAP ;
           SOME ;
           SWAP ;
           CAR ;
           PAIR ;
           DUG 2 ;
           GET 4 ;
           DUP ;
           PUSH nat 3 ;
           SWAP ;
           EDIV ;
           IF_NONE { PUSH int 20 ; FAILWITH } { CAR } ;
           SWAP ;
           DUP ;
           DUG 2 ;
           SUB ;
           ISNAT ;
           IF_NONE { PUSH int 20 ; FAILWITH } {} ;
           PUSH nat 3 ;
           DIG 2 ;
           EDIV ;
           IF_NONE { PUSH int 20 ; FAILWITH } { CAR } ;
           PAIR ;
           SWAP ;
           SPLIT_TICKET ;
           IF_NONE { PUSH int 20 ; FAILWITH } {} ;
           UNPAIR ;
           SWAP ;
           PAIR ;
           JOIN_TICKETS ;
           SWAP ;
           CDR ;
           SWAP ;
           PAIR ;
           NIL operation } ;
       PAIR }